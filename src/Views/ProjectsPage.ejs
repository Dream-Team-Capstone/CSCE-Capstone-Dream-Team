<!DOCTYPE html>
<html lang="en-us">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PyBlocks Projects</title>
    <link href='/StylesPages/ProjetsStyle.css' rel='stylesheet'>
    <script src="/Scripts/settingsHandler.js" defer></script>
    <!-- Hidden input to indicate if user is logged in -->
    <input type="hidden" name="isLoggedIn" value="<%= locals.user ? 'true' : 'false' %>">
    <link rel="stylesheet" href="/StylesPages/accessibilityStyles.css">
</head>    
<body>
<!-- NAV BAR START -->
<header class="navigation" role="banner">
    <nav aria-label="Main Navigation">
        <!-- Logo -->
        <ul class="navbar_logo" role="list">
            <li>
                <a href="/api/home" aria-label="PyBlocks Home">
                    <img class="logo" src="/ImagesUsed/pyBlocks_Updated.png" alt="PyBlocks logo">
                </a>
            </li>
        </ul>

        <!-- Navigation Buttons -->
        <ul class="navbar_buttons_list">
            <li><a href="#contact"><button class="Nav_Buttons" aria-disabled="true" aria-label="Contact Us page (Coming soon)">Contact Us</button></a></li>
            <li><a href="/api/tutorials"><button class="Nav_Buttons" aria-disabled="true" aria-label="Tutorials page (Coming soon)">Tutorials</button></a></li>
            <li><a href="/api/play"><button class="Nav_Buttons" aria-label="Start coding by going to the Play page">Play</button></a></li>
            <li><a href="#courses"><button class="Nav_Buttons" aria-disabled="true" aria-label="Courses page (Coming soon)">Courses</button></a></li>
            <li><a href="/api/resources"><button class="Nav_Buttons" aria-label="Access resources">Resources</button></a></li>
            <li>
                <% if (locals.user && locals.user !== null) { %>
                    <a href="/api/dashboard">
                        <button class="Nav_Buttons" aria-label="View your dashboard">Dashboard</button>
                    </a>
                <% } else { %>
                    <a href="/api/login">
                        <button class="Nav_Buttons" aria-label="Sign in to your account">Sign In</button>
                    </a>
                <% } %>
            </li>
            <li><a href="/api/register"><button class="Nav_Buttons" aria-label="Create new account">Register</button></a></li>
        </ul>

        <!-- Settings Icon -->
        <ul class="Settings_logo" role="list">
            <li>
                <a href="/api/settings" aria-label="Adjust application settings">
                    <img class="Settings_logo" src="/ImagesUsed/SettingsIcon.png" alt="Settings icon">
                </a>
            </li>
        </ul>
    </nav>
</header>
<!-- NAV BAR END -->

<!-- MAIN CONTENT -->
<main role="main" aria-label="Project List">
    <!-- Hello World Project -->
    <section class="Projects-container" role="region" aria-labelledby="project1-title">
        <ul class="Projects-list" role="list">
            <li class="project-description">
                <h2 id="project1-title">Hello World!</h2>
                <p id="project1-desc">This course teaches users how to print "Hello World!" using block code.
                Equally, the corresponding text code is provided for users to learn.</p>
                
                <% if (locals.user && locals.user !== null) { %>
                    <a href="/api/project-tutorials/hello-world">
                        <button class="project-button" 
                                aria-labelledby="project1-title"
                                aria-describedby="project1-desc">
                            Start Project!
                        </button>
                    </a>
                <% } else { %>
                    <a href="/api/login">
                        <button class="project-button" 
                                aria-label="Sign in to start Hello World project"
                                aria-describedby="login-required">
                            Start Project!
                        </button>
                    </a>
                    <span id="login-required" hidden>Please sign in to access this project</span>
                <% } %>
                <!-- Progress bar -->
                <div class="progress_container" role="region" aria-label="Project Progress">
                    <div class="progress_bar" 
                         role="progressbar"
                         aria-valuenow="<%= locals.user_progress ? Math.round(user_progress.project1_progress) : 0 %>"
                         aria-valuemin="0"
                         aria-valuemax="100"
                         aria-label="Project completion: <%= locals.user_progress ? Math.round(user_progress.project1_progress) : 0 %>%"
                         style="width: <%= locals.user_progress ? user_progress.project1_progress + '%' : '0%' %>">
                        <%= locals.user_progress ? Math.round(user_progress.project1_progress) : 0 %>%
                    </div>
                </div>
                <a class="clearProgress" role="region" aria-label="Clear progress" href="#">
                    <button class="clearProgressButton" aria-label="Clear progress">Clear Progress</button>
                </a>
            </li>
            <li class="project-image">
                <img src="../Public/ImagesUsed/HelloWorld.jpeg" 
                     alt="Visual representation of Hello World programming concept"
                     aria-labelledby="project1-title">
            </li>
        </ul>
    </section>

    <div class="Projects-container" role="region" aria-label="Future Project">
        <ul class="Projects-list">
            <!-- The two li's below are for the course description and the course image-->
             <!-- They may be flipped depending on the desired design -->
            <li class="project-image">
                <img src="../Public/ImagesUsed/HelloWorld.jpeg" 
                     alt="Placeholder image for upcoming project"
                     aria-labelledby="project2-title">
            </li>
            <li class="project-description">
                <h2 id="project2-title">Insert Title</h2>
                <p id="project2-desc">Insert Description</p>
                <% if (locals.user && locals.user !== null) { %>
                    <a href="#Comming Soon">
                        <button class="project-button" 
                                aria-label="Project coming soon"
                                disabled>
                            Start Project!
                        </button>
                    </a>
                <% } else { %>
                    <a href="/api/login">
                        <button class="project-button" 
                                aria-label="Sign in to access projects"
                                aria-describedby="login-required-2">
                            Start Project!
                        </button>
                    </a>
                    <span id="login-required-2" hidden>Please sign in to access this project</span>
                <% } %>
                <!-- Progress bar -->
                <div class="progress_container" role="region" aria-label="Project Progress">
                    <div class="progress_bar" 
                         role="progressbar"
                         aria-valuenow="<%= locals.user_progress ? Math.round(user_progress.project2_progress) : 0 %>"
                         aria-valuemin="0"
                         aria-valuemax="100"
                         aria-label="Project completion: <%= locals.user_progress ? Math.round(user_progress.project2_progress) : 0 %>%"
                         style="width: <%= locals.user_progress ? user_progress.project2_progress + '%' : '0%' %>">
                        <%= locals.user_progress ? Math.round(user_progress.project2_progress) : 0 %>%
                    </div>
                </div>
                <a class="clearProgress" role="region" aria-label="Clear progress" href="#">
                    <button class="clearProgressButton" aria-label="Clear progress">Clear Progress</button>
                </a>
            </li>
        </ul>
    </div>

    <!-- Third project container follows same pattern -->
    <div class="Projects-container" role="region" aria-label="Future Project">
        <ul class="Projects-list">
            <!-- The two li's below are for the course description and the course image-->
             <!-- They may be flipped depending on the desired design -->
            <li class="project-description">
                <h2 id="project3-title">Insert Title</h2>
                <p id="project3-desc">Insert Description</p>
                <% if (locals.user && locals.user !== null) { %>
                    <a href="#Comming Soon">
                        <button class="project-button" 
                                aria-label="Project coming soon"
                                disabled>
                            Start Project!
                        </button>
                    </a>
                <% } else { %>
                    <a href="/api/login">
                        <button class="project-button" 
                                aria-label="Sign in to access projects"
                                aria-describedby="login-required-3">
                            Start Project!
                        </button>
                    </a>
                    <span id="login-required-3" hidden>Please sign in to access this project</span>
                <% } %>
                <!-- Progress bar -->
                <div class="progress_container" role="region" aria-label="Project Progress">
                    <div class="progress_bar" 
                         role="progressbar"
                         aria-valuenow="<%= locals.user_progress ? Math.round(user_progress.project3_progress) : 0 %>"
                         aria-valuemin="0"
                         aria-valuemax="100"
                         aria-label="Project completion: <%= locals.user_progress ? Math.round(user_progress.project3_progress) : 0 %>%"
                         style="width: <%= locals.user_progress ? user_progress.project3_progress + '%' : '0%' %>">
                        <%= locals.user_progress ? Math.round(user_progress.project3_progress) : 0 %>%
                    </div>
                </div>
                <a class="clearProgress" role="region" aria-label="Clear progress" href="#">
                    <button class="clearProgressButton" aria-label="Clear progress">Clear Progress</button>
                </a>
            </li>
            <li class="project-image">
                <img src="../Public/ImagesUsed/HelloWorld.jpeg" 
                     alt="Placeholder image for upcoming project"
                     aria-labelledby="project3-title">
            </li>
        </ul>
    </div>
</main>

<!-- Add this after the main content, before the footer -->
<div id="clearProgressModal" class="modal" role="dialog" aria-labelledby="clearProgressModalTitle" aria-describedby="clearProgressModalDesc">
    <div class="modal-content">
        <h2 id="clearProgressModalTitle">Clear Progress?</h2>
        <p id="clearProgressModalDesc">Are you sure you want to clear your progress? This action cannot be undone.</p>
        <div class="modal-actions">
            <button class="modal-btn" id="confirmClearBtn" aria-label="Confirm clearing progress">Yes, Clear</button>
            <button class="modal-btn" id="cancelClearBtn" aria-label="Cancel clearing progress">Cancel</button>
        </div>
    </div>
</div>

<!-- FOOTER START -->
<footer role="contentinfo">
    <ul class="navbar_logo" role="list">
        <li>
            <a href="/api/home">
                <img class="logo" src="/ImagesUsed/pyBlocks_Updated.png" alt="PyBlocks logo, linking back to home page">
            </a>
        </li>
    </ul>

    <ul class="footer_buttons" role="list">
        <li><a href="/api/resources" aria-label="Access learning resources">Resources</a></li>
        <li><a href="/api/tutorials" aria-label="View available tutorials">Tutorials</a></li>
        <li><a href="#editors" aria-label="Open blank code editors">Open Blank Editors</a></li>
    </ul>
</footer>

<script>
    document.querySelectorAll('.clearProgressButton').forEach(button => {
        button.addEventListener('click', function(e) {
            e.preventDefault();
            const modal = document.getElementById('clearProgressModal');
            modal.style.display = 'flex';
            modal.setAttribute('aria-hidden', 'false');
            document.getElementById('confirmClearBtn').focus();
        });
    });

    // Add modal control functions
    document.getElementById('cancelClearBtn').addEventListener('click', function() {
        const modal = document.getElementById('clearProgressModal');
        modal.style.display = 'none';
        modal.setAttribute('aria-hidden', 'true');
    });

    document.getElementById('confirmClearBtn').addEventListener('click', async function() {
        const modal = document.getElementById('clearProgressModal');
        try {
            const response = await fetch('/api/project-tutorials/clear-progress', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                }
            });

            if (!response.ok) {
                throw new Error('Failed to clear progress');
            }

            const data = await response.json();
            modal.style.display = 'none';
            window.location.reload();
        } catch (error) {
            console.error('Error clearing progress:', error);
            let errorMessage = error.message;
            try {
                const errorData = await error.response.json();
                errorMessage = errorData.details || errorData.error || error.message;
            } catch (e) {
                // If we can't parse the error response, use the original error message
            }
            alert('Error clearing progress: ' + errorMessage);
        }
    });

    // Close modal when clicking outside
    window.addEventListener('click', function(event) {
        const modal = document.getElementById('clearProgressModal');
        if (event.target === modal) {
            modal.style.display = 'none';
            modal.setAttribute('aria-hidden', 'true');
        }
    });
</script>
</body>
</html>